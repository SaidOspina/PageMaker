<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constructor Visual de P√°ginas Web</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: #2c3e50;
            color: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #4a5f7a;
        }

        .sidebar-header h1 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
        }

        .elements-section {
            padding: 20px;
        }

        .section-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ecf0f1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .elements-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 30px;
        }

        .element-item {
            background: #3498db;
            padding: 12px 8px;
            border-radius: 8px;
            text-align: center;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 12px;
            border: 2px solid transparent;
        }

        .element-item:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .element-item:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .toolbar button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .canvas-container {
            flex: 1;
            background: #ecf0f1;
            overflow: auto;
            position: relative;
        }

        .canvas {
            min-height: 100%;
            background: white;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
            padding: 20px;
        }

        .drop-zone {
            min-height: 200px;
            border: 3px dashed #bdc3c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .canvas-element {
            margin: 10px 0;
            position: relative;
            min-height: 40px;
            border: 2px solid transparent;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .canvas-element:hover {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .canvas-element.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
        }

        .element-controls {
            position: absolute;
            top: -35px;
            right: 0;
            display: none;
            gap: 5px;
        }

        .canvas-element:hover .element-controls,
        .canvas-element.selected .element-controls {
            display: flex;
        }

        .control-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: #c0392b;
        }

        .properties-panel {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .properties-panel.active {
            right: 0;
        }

        .properties-header {
            padding: 20px;
            background: #34495e;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .properties-content {
            padding: 20px;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .property-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .code-preview {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }
            
            .elements-grid {
                grid-template-columns: 1fr;
            }

            .properties-panel {
                width: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar con elementos -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>üîß Web Builder</h1>
                <p>Arrastra elementos al canvas</p>
            </div>

            <!-- Elementos de Layout -->
            <div class="elements-section">
                <div class="section-title">üìê Layout</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="div">
                        üì¶ Div
                    </div>
                    <div class="element-item" draggable="true" data-type="section">
                        üìã Section
                    </div>
                    <div class="element-item" draggable="true" data-type="header">
                        üéØ Header
                    </div>
                    <div class="element-item" draggable="true" data-type="footer">
                        üîª Footer
                    </div>
                    <div class="element-item" draggable="true" data-type="nav">
                        üß≠ Nav
                    </div>
                    <div class="element-item" draggable="true" data-type="aside">
                        üìå Aside
                    </div>
                </div>
            </div>

            <!-- Elementos de Texto -->
            <div class="elements-section">
                <div class="section-title">üìù Texto</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="h1">
                        H1 T√≠tulo
                    </div>
                    <div class="element-item" draggable="true" data-type="h2">
                        H2 T√≠tulo
                    </div>
                    <div class="element-item" draggable="true" data-type="h3">
                        H3 T√≠tulo
                    </div>
                    <div class="element-item" draggable="true" data-type="p">
                        üìÑ P√°rrafo
                    </div>
                    <div class="element-item" draggable="true" data-type="span">
                        üè∑Ô∏è Span
                    </div>
                    <div class="element-item" draggable="true" data-type="a">
                        üîó Enlace
                    </div>
                </div>
            </div>

            <!-- Elementos de Formulario -->
            <div class="elements-section">
                <div class="section-title">üìù Formularios</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="form">
                        üìã Form
                    </div>
                    <div class="element-item" draggable="true" data-type="input">
                        üìù Input
                    </div>
                    <div class="element-item" draggable="true" data-type="textarea">
                        üìÑ Textarea
                    </div>
                    <div class="element-item" draggable="true" data-type="button">
                        üîò Button
                    </div>
                    <div class="element-item" draggable="true" data-type="select">
                        üìã Select
                    </div>
                    <div class="element-item" draggable="true" data-type="label">
                        üè∑Ô∏è Label
                    </div>
                </div>
            </div>

            <!-- Elementos Multimedia -->
            <div class="elements-section">
                <div class="section-title">üé® Multimedia</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="img">
                        üñºÔ∏è Imagen
                    </div>
                    <div class="element-item" draggable="true" data-type="video">
                        üé• Video
                    </div>
                    <div class="element-item" draggable="true" data-type="audio">
                        üéµ Audio
                    </div>
                    <div class="element-item" draggable="true" data-type="canvas">
                        üé® Canvas
                    </div>
                    <div class="element-item" draggable="true" data-type="svg">
                        ‚≠ê SVG
                    </div>
                    <div class="element-item" draggable="true" data-type="iframe">
                        üñºÔ∏è Iframe
                    </div>
                </div>
            </div>

            <!-- Elementos de Lista -->
            <div class="elements-section">
                <div class="section-title">üìã Listas</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="ul">
                        ‚Ä¢ Lista UL
                    </div>
                    <div class="element-item" draggable="true" data-type="ol">
                        1. Lista OL
                    </div>
                    <div class="element-item" draggable="true" data-type="li">
                        üìù Item LI
                    </div>
                    <div class="element-item" draggable="true" data-type="dl">
                        üìã Lista DL
                    </div>
                </div>
            </div>

            <!-- Elementos de Tabla -->
            <div class="elements-section">
                <div class="section-title">üìä Tablas</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="table">
                        üìä Table
                    </div>
                    <div class="element-item" draggable="true" data-type="tr">
                        üìù Fila TR
                    </div>
                    <div class="element-item" draggable="true" data-type="td">
                        üì¶ Celda TD
                    </div>
                    <div class="element-item" draggable="true" data-type="th">
                        üéØ Header TH
                    </div>
                </div>
            </div>
        </div>

        <!-- √Årea principal -->
        <div class="main-area">
            <!-- Toolbar -->
            <div class="toolbar">
                <button class="btn-primary" onclick="previewPage()">üëÅÔ∏è Vista Previa</button>
                <button class="btn-success" onclick="exportHTML()">üíæ Exportar HTML</button>
                <button class="btn-secondary" onclick="clearCanvas()">üóëÔ∏è Limpiar</button>
                <button class="btn-secondary" onclick="undoAction()">‚Ü∂ Deshacer</button>
                <button class="btn-secondary" onclick="toggleProperties()">‚öôÔ∏è Propiedades</button>
            </div>

            <!-- Canvas -->
            <div class="canvas-container">
                <div class="canvas" id="canvas">
                    <div class="drop-zone" id="dropZone">
                        ‚ú® Arrastra elementos aqu√≠ para comenzar a crear tu p√°gina web
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel de propiedades -->
    <div class="properties-panel" id="propertiesPanel">
        <div class="properties-header">
            <h3>‚öôÔ∏è Propiedades</h3>
            <button class="close" onclick="toggleProperties()">&times;</button>
        </div>
        <div class="properties-content" id="propertiesContent">
            <p>Selecciona un elemento para editar sus propiedades</p>
        </div>
    </div>

    <!-- Modal de vista previa -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üëÅÔ∏è Vista Previa</h2>
                <button class="close" onclick="closeModal('previewModal')">&times;</button>
            </div>
            <iframe id="previewFrame" style="width: 100%; height: 500px; border: 1px solid #ddd; border-radius: 4px;"></iframe>
        </div>
    </div>

    <!-- Modal de exportaci√≥n -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíæ C√≥digo HTML</h2>
                <button class="close" onclick="closeModal('exportModal')">&times;</button>
            </div>
            <button class="btn-primary" onclick="copyToClipboard()" style="margin-bottom: 15px;">üìã Copiar C√≥digo</button>
            <div class="code-preview" id="codePreview"></div>
        </div>
    </div>

    <!-- Toast para mensajes -->
    <div class="toast" id="toast"></div>

    <script>
        // Variables globales
        let selectedElement = null;
        let canvas = document.getElementById('canvas');
        let dropZone = document.getElementById('dropZone');
        let draggedElement = null;
        let history = [];
        let historyStep = -1;

        // Elementos HTML predefinidos con sus propiedades
        const elementTemplates = {
            div: {
                tag: 'div',
                content: 'Contenedor div',
                style: 'padding: 20px; border: 1px solid #ddd;',
                properties: ['id', 'class', 'style', 'onclick']
            },
            section: {
                tag: 'section',
                content: 'Secci√≥n de contenido',
                style: 'padding: 20px; background: #f9f9f9;',
                properties: ['id', 'class', 'style']
            },
            header: {
                tag: 'header',
                content: 'Encabezado de p√°gina',
                style: 'padding: 20px; background: #34495e; color: white;',
                properties: ['id', 'class', 'style']
            },
            footer: {
                tag: 'footer',
                content: 'Pie de p√°gina',
                style: 'padding: 20px; background: #2c3e50; color: white; text-align: center;',
                properties: ['id', 'class', 'style']
            },
            nav: {
                tag: 'nav',
                content: '<a href="#" style="margin-right: 15px;">Inicio</a><a href="#" style="margin-right: 15px;">Acerca de</a><a href="#">Contacto</a>',
                style: 'padding: 15px; background: #3498db;',
                properties: ['id', 'class', 'style']
            },
            aside: {
                tag: 'aside',
                content: 'Contenido lateral',
                style: 'padding: 15px; background: #ecf0f1; border-left: 3px solid #3498db;',
                properties: ['id', 'class', 'style']
            },
            h1: {
                tag: 'h1',
                content: 'T√≠tulo Principal',
                style: 'color: #2c3e50;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            h2: {
                tag: 'h2',
                content: 'Subt√≠tulo',
                style: 'color: #34495e;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            h3: {
                tag: 'h3',
                content: 'Encabezado H3',
                style: 'color: #5d6d7e;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            p: {
                tag: 'p',
                content: 'Este es un p√°rrafo de texto. Puedes editar este contenido desde las propiedades.',
                style: 'line-height: 1.6; color: #333;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            span: {
                tag: 'span',
                content: 'Texto en l√≠nea',
                style: 'background: #f1c40f; padding: 2px 6px;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            a: {
                tag: 'a',
                content: 'Enlace de ejemplo',
                style: 'color: #3498db; text-decoration: none;',
                properties: ['id', 'class', 'style', 'href', 'target', 'textContent']
            },
            form: {
                tag: 'form',
                content: '<label>Nombre:</label><input type="text" name="nombre"><br><br><button type="submit">Enviar</button>',
                style: 'padding: 20px; border: 1px solid #ddd;',
                properties: ['id', 'class', 'action', 'method', 'style']
            },
            input: {
                tag: 'input',
                content: '',
                style: 'padding: 8px; border: 1px solid #ddd; border-radius: 4px;',
                properties: ['id', 'name', 'type', 'placeholder', 'value', 'class', 'style', 'required']
            },
            textarea: {
                tag: 'textarea',
                content: '√Årea de texto...',
                style: 'padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; height: 100px;',
                properties: ['id', 'name', 'placeholder', 'class', 'style', 'rows', 'cols']
            },
            button: {
                tag: 'button',
                content: 'Bot√≥n',
                style: 'padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;',
                properties: ['id', 'class', 'type', 'onclick', 'style', 'textContent']
            },
            select: {
                tag: 'select',
                content: '<option value="1">Opci√≥n 1</option><option value="2">Opci√≥n 2</option><option value="3">Opci√≥n 3</option>',
                style: 'padding: 8px; border: 1px solid #ddd; border-radius: 4px;',
                properties: ['id', 'name', 'class', 'style', 'multiple']
            },
            label: {
                tag: 'label',
                content: 'Etiqueta:',
                style: 'font-weight: bold; margin-bottom: 5px; display: block;',
                properties: ['for', 'class', 'style', 'textContent']
            },
            img: {
                tag: 'img',
                content: '',
                style: 'max-width: 100%; height: auto; border: 1px solid #ddd;',
                properties: ['src', 'alt', 'width', 'height', 'class', 'style']
            },
            video: {
                tag: 'video',
                content: '',
                style: 'width: 100%; max-width: 500px;',
                properties: ['src', 'controls', 'width', 'height', 'autoplay', 'loop', 'class', 'style']
            },
            audio: {
                tag: 'audio',
                content: '',
                style: 'width: 100%;',
                properties: ['src', 'controls', 'autoplay', 'loop', 'class', 'style']
            },
            canvas: {
                tag: 'canvas',
                content: '',
                style: 'border: 1px solid #ddd; background: #f9f9f9;',
                properties: ['width', 'height', 'class', 'style', 'id']
            },
            svg: {
                tag: 'svg',
                content: '<circle cx="50" cy="50" r="30" fill="#3498db"/>',
                style: 'border: 1px solid #ddd;',
                properties: ['width', 'height', 'viewBox', 'class', 'style']
            },
            iframe: {
                tag: 'iframe',
                content: '',
                style: 'width: 100%; height: 300px; border: 1px solid #ddd;',
                properties: ['src', 'width', 'height', 'frameborder', 'class', 'style']
            },
            ul: {
                tag: 'ul',
                content: '<li>Elemento de lista 1</li><li>Elemento de lista 2</li><li>Elemento de lista 3</li>',
                style: 'padding-left: 20px;',
                properties: ['id', 'class', 'style']
            },
            ol: {
                tag: 'ol',
                content: '<li>Primer elemento</li><li>Segundo elemento</li><li>Tercer elemento</li>',
                style: 'padding-left: 20px;',
                properties: ['id', 'class', 'style', 'type', 'start']
            },
            li: {
                tag: 'li',
                content: 'Elemento de lista',
                style: 'margin-bottom: 5px;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            dl: {
                tag: 'dl',
                content: '<dt>T√©rmino</dt><dd>Definici√≥n del t√©rmino</dd><dt>Otro t√©rmino</dt><dd>Otra definici√≥n</dd>',
                style: 'padding: 10px;',
                properties: ['id', 'class', 'style']
            },
            table: {
                tag: 'table',
                content: '<tr><th>Columna 1</th><th>Columna 2</th></tr><tr><td>Dato 1</td><td>Dato 2</td></tr><tr><td>Dato 3</td><td>Dato 4</td></tr>',
                style: 'width: 100%; border-collapse: collapse; border: 1px solid #ddd;',
                properties: ['id', 'class', 'style', 'border', 'cellpadding', 'cellspacing']
            },
            tr: {
                tag: 'tr',
                content: '<td>Celda 1</td><td>Celda 2</td>',
                style: 'border-bottom: 1px solid #ddd;',
                properties: ['id', 'class', 'style']
            },
            td: {
                tag: 'td',
                content: 'Contenido de celda',
                style: 'padding: 8px; border: 1px solid #ddd;',
                properties: ['id', 'class', 'style', 'colspan', 'rowspan', 'textContent']
            },
            th: {
                tag: 'th',
                content: 'Encabezado',
                style: 'padding: 8px; border: 1px solid #ddd; background: #f2f2f2; font-weight: bold;',
                properties: ['id', 'class', 'style', 'colspan', 'rowspan', 'textContent']
            }
        };

        // Event listeners para drag and drop
        document.querySelectorAll('.element-item').forEach(item => {
            item.addEventListener('dragstart', handleDragStart);
        });

        canvas.addEventListener('dragover', handleDragOver);
        canvas.addEventListener('drop', handleDrop);
        canvas.addEventListener('dragleave', handleDragLeave);

        function handleDragStart(e) {
            draggedElement = e.target.dataset.type;
            e.dataTransfer.effectAllowed = 'copy';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            if (e.target === dropZone || e.target === canvas) {
                dropZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (!canvas.contains(e.relatedTarget)) {
                dropZone.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            
            if (draggedElement && elementTemplates[draggedElement]) {
                createAndAddElement(draggedElement);
                saveToHistory();
            }
        }

        function createAndAddElement(elementType) {
            const template = elementTemplates[elementType];
            const element = document.createElement(template.tag);
            
            // Agregar contenido
            if (template.content) {
                if (template.tag === 'img' || template.tag === 'input' || template.tag === 'video' || template.tag === 'audio' || template.tag === 'canvas' || template.tag === 'iframe') {
                    // Elementos que no tienen contenido de texto
                    if (template.tag === 'img') {
                        element.src = 'https://via.placeholder.com/300x200?text=Imagen';
                        element.alt = 'Imagen de ejemplo';
                    } else if (template.tag === 'input') {
                        element.type = 'text';
                        element.placeholder = 'Escribe aqu√≠...';
                    } else if (template.tag === 'video') {
                        element.controls = true;
                        element.innerHTML = '<source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">Tu navegador no soporta video HTML5.';
                    } else if (template.tag === 'audio') {
                        element.controls = true;
                        element.innerHTML = '<source src="https://www.w3schools.com/html/horse.ogg" type="audio/ogg">Tu navegador no soporta audio HTML5.';
                    } else if (template.tag === 'canvas') {
                        element.width = 400;
                        element.height = 200;
                    } else if (template.tag === 'iframe') {
                        element.src = 'https://www.example.com';
                    }
                } else {
                    element.innerHTML = template.content;
                }
            }

            // Agregar estilos
            if (template.style) {
                element.style.cssText = template.style;
            }

            // Crear wrapper con controles
            const wrapper = document.createElement('div');
            wrapper.className = 'canvas-element';
            wrapper.dataset.elementType = elementType;
            
            // Controles del elemento
            const controls = document.createElement('div');
            controls.className = 'element-controls';
            controls.innerHTML = `
                <button class="control-btn" onclick="editElement(this)" title="Editar">‚úèÔ∏è</button>
                <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">üìã</button>
                <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">üóëÔ∏è</button>
            `;

            wrapper.appendChild(element);
            wrapper.appendChild(controls);

            // Agregar al canvas
            if (dropZone.style.display !== 'none') {
                dropZone.style.display = 'none';
            }
            canvas.appendChild(wrapper);

            // Event listeners
            wrapper.addEventListener('click', selectElement);

            showToast('Elemento agregado correctamente');
        }

        function selectElement(e) {
            // Remover selecci√≥n anterior
            document.querySelectorAll('.canvas-element.selected').forEach(el => {
                el.classList.remove('selected');
            });

            // Seleccionar elemento actual
            const wrapper = e.currentTarget;
            wrapper.classList.add('selected');
            selectedElement = wrapper;

            // Mostrar propiedades
            showElementProperties(wrapper);
            e.stopPropagation();
        }

        function showElementProperties(wrapper) {
            const elementType = wrapper.dataset.elementType;
            const template = elementTemplates[elementType];
            const element = wrapper.querySelector(template.tag);

            const propertiesContent = document.getElementById('propertiesContent');
            propertiesContent.innerHTML = `
                <h4>Elemento: ${template.tag.toUpperCase()}</h4>
                <div id="propertyFields"></div>
            `;

            const propertyFields = document.getElementById('propertyFields');

            template.properties.forEach(prop => {
                const group = document.createElement('div');
                group.className = 'property-group';

                const label = document.createElement('label');
                label.className = 'property-label';
                label.textContent = prop.charAt(0).toUpperCase() + prop.slice(1);

                let input;
                if (prop === 'textContent') {
                    input = document.createElement('textarea');
                    input.value = element.textContent || '';
                } else if (prop === 'style') {
                    input = document.createElement('textarea');
                    input.value = element.style.cssText || '';
                } else if (prop === 'type' && template.tag === 'input') {
                    input = document.createElement('select');
                    const types = ['text', 'email', 'password', 'number', 'date', 'checkbox', 'radio', 'file', 'hidden'];
                    types.forEach(type => {
                        const option = document.createElement('option');
                        option.value = type;
                        option.textContent = type;
                        if (element.type === type) option.selected = true;
                        input.appendChild(option);
                    });
                } else if (prop === 'target' && template.tag === 'a') {
                    input = document.createElement('select');
                    const targets = ['', '_blank', '_self', '_parent', '_top'];
                    targets.forEach(target => {
                        const option = document.createElement('option');
                        option.value = target;
                        option.textContent = target || 'Sin target';
                        if (element.target === target) option.selected = true;
                        input.appendChild(option);
                    });
                } else {
                    input = document.createElement('input');
                    input.type = 'text';
                    input.value = element.getAttribute(prop) || '';
                }

                input.className = 'property-input';
                input.addEventListener('input', () => updateElementProperty(element, prop, input.value));

                group.appendChild(label);
                group.appendChild(input);
                propertyFields.appendChild(group);
            });
        }

        function updateElementProperty(element, property, value) {
            if (property === 'textContent') {
                element.textContent = value;
            } else if (property === 'style') {
                element.style.cssText = value;
            } else {
                if (value) {
                    element.setAttribute(property, value);
                } else {
                    element.removeAttribute(property);
                }
            }
        }

        function editElement(btn) {
            const wrapper = btn.closest('.canvas-element');
            selectElement({ currentTarget: wrapper, stopPropagation: () => {} });
            toggleProperties(true);
        }

        function duplicateElement(btn) {
            const wrapper = btn.closest('.canvas-element');
            const elementType = wrapper.dataset.elementType;
            createAndAddElement(elementType);
            saveToHistory();
        }

        function deleteElement(btn) {
            const wrapper = btn.closest('.canvas-element');
            wrapper.remove();
            
            // Mostrar drop zone si no hay elementos
            if (canvas.children.length === 1) { // Solo queda el dropZone
                dropZone.style.display = 'flex';
            }
            
            saveToHistory();
            showToast('Elemento eliminado');
        }

        function toggleProperties(forceOpen = false) {
            const panel = document.getElementById('propertiesPanel');
            if (forceOpen || !panel.classList.contains('active')) {
                panel.classList.add('active');
            } else {
                panel.classList.remove('active');
            }
        }

        function previewPage() {
            const previewModal = document.getElementById('previewModal');
            const previewFrame = document.getElementById('previewFrame');
            
            const htmlContent = generateHTMLContent();
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            previewFrame.src = url;
            previewModal.style.display = 'block';
        }

        function exportHTML() {
            const exportModal = document.getElementById('exportModal');
            const codePreview = document.getElementById('codePreview');
            
            codePreview.textContent = generateHTMLContent();
            exportModal.style.display = 'block';
        }

        function generateHTMLContent() {
            const elements = canvas.querySelectorAll('.canvas-element');
            let bodyContent = '';

            elements.forEach(wrapper => {
                const element = wrapper.firstElementChild;
                bodyContent += element.outerHTML + '\n';
            });

            return `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi P√°gina Web</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
${bodyContent}
</body>
</html>`;
        }

        function copyToClipboard() {
            const codePreview = document.getElementById('codePreview');
            const textArea = document.createElement('textarea');
            textArea.value = codePreview.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast('C√≥digo copiado al portapapeles');
        }

        function clearCanvas() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar el canvas?')) {
                canvas.innerHTML = '<div class="drop-zone" id="dropZone">‚ú® Arrastra elementos aqu√≠ para comenzar a crear tu p√°gina web</div>';
                dropZone = document.getElementById('dropZone');
                canvas.addEventListener('dragover', handleDragOver);
                canvas.addEventListener('drop', handleDrop);
                canvas.addEventListener('dragleave', handleDragLeave);
                selectedElement = null;
                document.getElementById('propertiesContent').innerHTML = '<p>Selecciona un elemento para editar sus propiedades</p>';
                saveToHistory();
                showToast('Canvas limpiado');
            }
        }

        function saveToHistory() {
            historyStep++;
            if (historyStep < history.length) {
                history.length = historyStep;
            }
            history.push(canvas.innerHTML);
        }

        function undoAction() {
            if (historyStep > 0) {
                historyStep--;
                canvas.innerHTML = history[historyStep];
                dropZone = document.getElementById('dropZone');
                
                // Reattach event listeners
                canvas.querySelectorAll('.canvas-element').forEach(wrapper => {
                    wrapper.addEventListener('click', selectElement);
                });
                
                showToast('Acci√≥n deshecha');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Click fuera del canvas para deseleccionar
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.canvas-element') && !e.target.closest('.properties-panel')) {
                document.querySelectorAll('.canvas-element.selected').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedElement = null;
            }
        });

        // Cerrar modales con ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
        });

        // Cerrar modales clickeando fuera
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Inicializar historial
        saveToHistory();

        console.log('üéâ Web Builder cargado correctamente');
        console.log('üí° Tip: Arrastra elementos desde el sidebar hacia el canvas para comenzar');
    </script>
</body>
</html> '