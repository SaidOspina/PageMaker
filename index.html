<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PageMaker Enhanced - Constructor Visual</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 300px;
            background: #2c3e50;
            color: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #4a5f7a;
        }

        .sidebar-header h1 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
        }

        .elements-section {
            padding: 20px;
        }

        .section-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ecf0f1;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .elements-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 30px;
        }

        .element-item {
            background: #3498db;
            padding: 12px 8px;
            border-radius: 8px;
            text-align: center;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 12px;
            border: 2px solid transparent;
        }

        .element-item:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .element-item.template {
            background: #9b59b6;
        }

        .element-item.template:hover {
            background: #8e44ad;
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
        }

        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .toolbar button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-purple {
            background: #9b59b6;
            color: white;
        }

        .btn-purple:hover {
            background: #8e44ad;
        }

        .canvas-container {
            flex: 1;
            background: #ecf0f1;
            overflow: auto;
            position: relative;
        }

        .canvas {
            min-height: 100%;
            background: white;
            margin: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: relative;
            padding: 20px;
        }

        .drop-zone {
            min-height: 200px;
            border: 3px dashed #bdc3c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .canvas-element {
            margin: 10px 0;
            position: relative;
            border: 2px solid transparent;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .canvas-element:hover {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .canvas-element.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.2);
        }

        .canvas-element.container {
            background: rgba(52, 152, 219, 0.05);
            padding: 20px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            min-height: 100px;
        }

        .canvas-element.container:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .canvas-element.container.selected {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.05);
        }

        .nested-elements {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            min-height: 50px;
        }

        .nested-drop-zone {
            min-height: 50px;
            border: 2px dashed #bdc3c7;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px 0;
        }

        .nested-drop-zone.drag-over {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .element-controls {
            position: absolute;
            top: -35px;
            right: 0;
            display: none;
            gap: 5px;
            z-index: 10;
        }

        .canvas-element:hover .element-controls,
        .canvas-element.selected .element-controls {
            display: flex;
        }

        .control-btn {
            background: #e74c3c;
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: #c0392b;
        }

        .properties-panel {
            position: fixed;
            right: -320px;
            top: 0;
            width: 320px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .properties-panel.active {
            right: 0;
        }

        .properties-header {
            padding: 20px;
            background: #34495e;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .properties-content {
            padding: 20px;
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .property-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 900px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .code-preview {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .template-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .template-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .template-card h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .template-card p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .element-breadcrumb {
            background: #ecf0f1;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .tree-view {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .tree-item {
            padding: 3px 0;
            cursor: pointer;
            color: #495057;
            font-size: 14px;
        }

        .tree-item:hover {
            color: #007bff;
        }

        .tree-item.selected {
            color: #dc3545;
            font-weight: bold;
        }

        .tree-indent {
            margin-left: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
            }
            
            .elements-grid {
                grid-template-columns: 1fr;
            }

            .properties-panel {
                width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar con elementos -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>🔧 PageMaker Pro</h1>
                <p>Constructor visual avanzado</p>
            </div>

            <!-- Plantillas predefinidas -->
            <div class="elements-section">
                <div class="section-title">🎨 Plantillas</div>
                <div class="elements-grid">
                    <div class="element-item template" onclick="loadTemplate('landing')">
                        🏠 Landing Page
                    </div>
                    <div class="element-item template" onclick="loadTemplate('blog')">
                        📝 Blog Post
                    </div>
                    <div class="element-item template" onclick="loadTemplate('portfolio')">
                        💼 Portfolio
                    </div>
                    <div class="element-item template" onclick="loadTemplate('contact')">
                        📞 Contacto
                    </div>
                </div>
            </div>

            <!-- Elementos de Layout -->
            <div class="elements-section">
                <div class="section-title">📐 Layout</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="container">
                        📦 Container
                    </div>
                    <div class="element-item" draggable="true" data-type="section">
                        📋 Section
                    </div>
                    <div class="element-item" draggable="true" data-type="header">
                        🎯 Header
                    </div>
                    <div class="element-item" draggable="true" data-type="footer">
                        🔻 Footer
                    </div>
                    <div class="element-item" draggable="true" data-type="nav">
                        🧭 Nav
                    </div>
                    <div class="element-item" draggable="true" data-type="aside">
                        📌 Aside
                    </div>
                    <div class="element-item" draggable="true" data-type="grid">
                        ⊞ Grid
                    </div>
                    <div class="element-item" draggable="true" data-type="flexbox">
                        ⟷ Flexbox
                    </div>
                </div>
            </div>

            <!-- Elementos de Texto -->
            <div class="elements-section">
                <div class="section-title">📝 Texto</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="h1">
                        H1 Título
                    </div>
                    <div class="element-item" draggable="true" data-type="h2">
                        H2 Título
                    </div>
                    <div class="element-item" draggable="true" data-type="h3">
                        H3 Título
                    </div>
                    <div class="element-item" draggable="true" data-type="p">
                        📄 Párrafo
                    </div>
                    <div class="element-item" draggable="true" data-type="span">
                        🏷️ Span
                    </div>
                    <div class="element-item" draggable="true" data-type="a">
                        🔗 Enlace
                    </div>
                </div>
            </div>

            <!-- Elementos de Formulario -->
            <div class="elements-section">
                <div class="section-title">📝 Formularios</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="form">
                        📋 Form
                    </div>
                    <div class="element-item" draggable="true" data-type="input">
                        📝 Input
                    </div>
                    <div class="element-item" draggable="true" data-type="textarea">
                        📄 Textarea
                    </div>
                    <div class="element-item" draggable="true" data-type="button">
                        🔘 Button
                    </div>
                    <div class="element-item" draggable="true" data-type="select">
                        📋 Select
                    </div>
                    <div class="element-item" draggable="true" data-type="label">
                        🏷️ Label
                    </div>
                </div>
            </div>

            <!-- Elementos Multimedia -->
            <div class="elements-section">
                <div class="section-title">🎨 Multimedia</div>
                <div class="elements-grid">
                    <div class="element-item" draggable="true" data-type="img">
                        🖼️ Imagen
                    </div>
                    <div class="element-item" draggable="true" data-type="video">
                        🎥 Video
                    </div>
                    <div class="element-item" draggable="true" data-type="audio">
                        🎵 Audio
                    </div>
                    <div class="element-item" draggable="true" data-type="canvas">
                        🎨 Canvas
                    </div>
                </div>
            </div>
        </div>

        <!-- Área principal -->
        <div class="main-area">
            <!-- Toolbar -->
            <div class="toolbar">
                <button class="btn-purple" onclick="showTemplates()">🎨 Plantillas</button>
                <button class="btn-primary" onclick="previewPage()">👁️ Vista Previa</button>
                <button class="btn-success" onclick="exportHTML()">💾 Exportar HTML</button>
                <button class="btn-secondary" onclick="clearCanvas()">🗑️ Limpiar</button>
                <button class="btn-secondary" onclick="undoAction()">↶ Deshacer</button>
                <button class="btn-secondary" onclick="toggleProperties()">⚙️ Propiedades</button>
            </div>

            <!-- Canvas -->
            <div class="canvas-container">
                <div class="canvas" id="canvas">
                    <div class="drop-zone" id="dropZone">
                        ✨ Arrastra elementos aquí para comenzar a crear tu página web
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Panel de propiedades -->
    <div class="properties-panel" id="propertiesPanel">
        <div class="properties-header">
            <h3>⚙️ Propiedades</h3>
            <button class="close" onclick="toggleProperties()">&times;</button>
        </div>
        <div class="properties-content" id="propertiesContent">
            <div class="element-breadcrumb" id="elementBreadcrumb" style="display: none;"></div>
            <div class="tree-view" id="elementTree" style="display: none;"></div>
            <p>Selecciona un elemento para editar sus propiedades</p>
        </div>
    </div>

    <!-- Modal de plantillas -->
    <div class="modal" id="templatesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🎨 Plantillas Predefinidas</h2>
                <button class="close" onclick="closeModal('templatesModal')">&times;</button>
            </div>
            <div id="templatesContent">
                <div class="templates-grid">
                    <div class="template-card" onclick="loadTemplate('landing')">
                        <h3>🏠 Landing Page</h3>
                        <p>Página de aterrizaje completa con header, hero section, características y footer</p>
                    </div>
                    <div class="template-card" onclick="loadTemplate('blog')">
                        <h3>📝 Blog Post</h3>
                        <p>Estructura de artículo con título, contenido, sidebar y comentarios</p>
                    </div>
                    <div class="template-card" onclick="loadTemplate('portfolio')">
                        <h3>💼 Portfolio</h3>
                        <p>Portafolio profesional con galería de proyectos y información personal</p>
                    </div>
                    <div class="template-card" onclick="loadTemplate('contact')">
                        <h3>📞 Página de Contacto</h3>
                        <p>Formulario de contacto con información de ubicación y redes sociales</p>
                    </div>
                    <div class="template-card" onclick="loadTemplate('ecommerce')">
                        <h3>🛒 E-commerce</h3>
                        <p>Página de producto con galería, descripción y carrito de compras</p>
                    </div>
                    <div class="template-card" onclick="loadTemplate('dashboard')">
                        <h3>📊 Dashboard</h3>
                        <p>Panel de administración con gráficos y tablas de datos</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de vista previa -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>👁️ Vista Previa</h2>
                <button class="close" onclick="closeModal('previewModal')">&times;</button>
            </div>
            <iframe id="previewFrame" style="width: 100%; height: 500px; border: 1px solid #ddd; border-radius: 4px;"></iframe>
        </div>
    </div>

    <!-- Modal de exportación -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>💾 Código HTML</h2>
                <button class="close" onclick="closeModal('exportModal')">&times;</button>
            </div>
            <button class="btn-primary" onclick="copyToClipboard()" style="margin-bottom: 15px;">📋 Copiar Código</button>
            <button class="btn-success" onclick="downloadHTML()" style="margin-bottom: 15px; margin-left: 10px;">💾 Descargar HTML</button>
            <div class="code-preview" id="codePreview"></div>
        </div>
    </div>

    <!-- Toast para mensajes -->
    <div class="toast" id="toast"></div>

    <script>
        // Variables globales
        let selectedElement = null;
        let canvas = document.getElementById('canvas');
        let dropZone = document.getElementById('dropZone');
        let draggedElement = null;
        let history = [];
        let historyStep = -1;
        let elementCounter = 0;

        // Plantillas predefinidas
        const templates = {
            landing: `
                <div class="canvas-element container" data-element-type="container" data-element-id="container_1">
                    <div class="element-controls">
                        <button class="control-btn" onclick="editElement(this)" title="Editar">✏️</button>
                        <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">📋</button>
                        <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">🗑️</button>
                    </div>
                    <header style="background: #2c3e50; color: white; padding: 20px; text-align: center;">
                        <h1>Mi Sitio Web</h1>
                        <nav style="margin-top: 20px;">
                            <a href="#inicio" style="color: white; margin: 0 15px; text-decoration: none;">Inicio</a>
                            <a href="#servicios" style="color: white; margin: 0 15px; text-decoration: none;">Servicios</a>
                            <a href="#contacto" style="color: white; margin: 0 15px; text-decoration: none;">Contacto</a>
                        </nav>
                    </header>
                    <div class="nested-elements">
                        <section style="padding: 60px 20px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <h2 style="font-size: 3rem; margin-bottom: 20px;">Bienvenido a Nuestro Sitio</h2>
                            <p style="font-size: 1.2rem; margin-bottom: 30px;">Creamos soluciones web increíbles para tu negocio</p>
                            <button style="background: #e74c3c; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 1.1rem; cursor: pointer;">Comenzar Ahora</button>
                        </section>
                        <section style="padding: 60px 20px; background: #f8f9fa;">
                            <h2 style="text-align: center; margin-bottom: 40px; color: #2c3e50;">Nuestros Servicios</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; max-width: 1200px; margin: 0 auto;">
                                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                                    <h3 style="color: #3498db; margin-bottom: 15px;">Desarrollo Web</h3>
                                    <p>Creamos sitios web modernos y responsivos</p>
                                </div>
                                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                                    <h3 style="color: #3498db; margin-bottom: 15px;">Diseño UX/UI</h3>
                                    <p>Interfaces atractivas y fáciles de usar</p>
                                </div>
                                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center;">
                                    <h3 style="color: #3498db; margin-bottom: 15px;">SEO</h3>
                                    <p>Optimización para motores de búsqueda</p>
                                </div>
                            </div>
                        </section>
                        <footer style="background: #34495e; color: white; padding: 40px 20px; text-align: center;">
                            <p>&copy; 2024 Mi Sitio Web. Todos los derechos reservados.</p>
                            <div style="margin-top: 20px;">
                                <a href="#" style="color: white; margin: 0 10px; text-decoration: none;">Facebook</a>
                                <a href="#" style="color: white; margin: 0 10px; text-decoration: none;">Twitter</a>
                                <a href="#" style="color: white; margin: 0 10px; text-decoration: none;">LinkedIn</a>
                            </div>
                        </footer>
                    </div>
                </div>
            `,
            blog: `
                <div class="canvas-element container" data-element-type="container" data-element-id="container_2">
                    <div class="element-controls">
                        <button class="control-btn" onclick="editElement(this)" title="Editar">✏️</button>
                        <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">📋</button>
                        <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">🗑️</button>
                    </div>
                    <div class="nested-elements">
                        <header style="background: #2c3e50; color: white; padding: 20px; text-align: center;">
                            <h1>Mi Blog</h1>
                            <nav style="margin-top: 15px;">
                                <a href="#" style="color: white; margin: 0 15px; text-decoration: none;">Inicio</a>
                                <a href="#" style="color: white; margin: 0 15px; text-decoration: none;">Artículos</a>
                                <a href="#" style="color: white; margin: 0 15px; text-decoration: none;">Acerca de</a>
                            </nav>
                        </header>
                        <div style="display: grid; grid-template-columns: 1fr 300px; gap: 40px; max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
                            <article style="background: white; padding: 40px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                <h1 style="color: #2c3e50; margin-bottom: 20px;">Título del Artículo</h1>
                                <p style="color: #7f8c8d; margin-bottom: 30px;">Publicado el 15 de Junio, 2024 por Juan Pérez</p>
                                <img src="https://via.placeholder.com/600x300?text=Imagen+del+Artículo" alt="Imagen del artículo" style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 30px;">
                                <p style="line-height: 1.8; margin-bottom: 20px; color: #333;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
                                <p style="line-height: 1.8; margin-bottom: 20px; color: #333;">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                                <h3 style="color: #2c3e50; margin: 30px 0 15px 0;">Subtítulo del Artículo</h3>
                                <p style="line-height: 1.8; margin-bottom: 20px; color: #333;">Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis.</p>
                            </article>
                            <aside style="background: #f8f9fa; padding: 30px; border-radius: 10px; height: fit-content;">
                                <h3 style="color: #2c3e50; margin-bottom: 20px;">Artículos Recientes</h3>
                                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #dee2e6;">
                                    <h4 style="color: #3498db; margin-bottom: 10px;">Cómo crear una página web</h4>
                                    <p style="color: #7f8c8d; font-size: 14px;">Una guía completa para principiantes</p>
                                </div>
                                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #dee2e6;">
                                    <h4 style="color: #3498db; margin-bottom: 10px;">Tendencias de diseño 2024</h4>
                                    <p style="color: #7f8c8d; font-size: 14px;">Las últimas tendencias en diseño web</p>
                                </div>
                                <div style="margin-bottom: 20px;">
                                    <h4 style="color: #3498db; margin-bottom: 10px;">SEO para principiantes</h4>
                                    <p style="color: #7f8c8d; font-size: 14px;">Optimiza tu sitio web para Google</p>
                                </div>
                            </aside>
                        </div>
                    </div>
                </div>
            `,
            portfolio: `
                <div class="canvas-element container" data-element-type="container" data-element-id="container_3">
                    <div class="element-controls">
                        <button class="control-btn" onclick="editElement(this)" title="Editar">✏️</button>
                        <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">📋</button>
                        <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">🗑️</button>
                    </div>
                    <div class="nested-elements">
                        <header style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 80px 20px; text-align: center;">
                            <img src="https://via.placeholder.com/150x150?text=Foto" alt="Foto de perfil" style="width: 150px; height: 150px; border-radius: 50%; border: 5px solid white; margin-bottom: 20px;">
                            <h1 style="font-size: 2.5rem; margin-bottom: 10px;">Juan Pérez</h1>
                            <h2 style="font-size: 1.5rem; font-weight: 300; margin-bottom: 20px;">Desarrollador Full Stack</h2>
                            <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto;">Apasionado por crear experiencias web increíbles con tecnologías modernas</p>
                        </header>
                        <section style="padding: 60px 20px; background: #f8f9fa;">
                            <div style="max-width: 1200px; margin: 0 auto;">
                                <h2 style="text-align: center; margin-bottom: 40px; color: #2c3e50;">Mis Proyectos</h2>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px;">
                                    <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
                                        <img src="https://via.placeholder.com/400x250?text=Proyecto+1" alt="Proyecto 1" style="width: 100%; height: 250px; object-fit: cover;">
                                        <div style="padding: 25px;">
                                            <h3 style="color: #2c3e50; margin-bottom: 15px;">E-commerce Platform</h3>
                                            <p style="color: #7f8c8d; margin-bottom: 20px;">Plataforma de comercio electrónico con React y Node.js</p>
                                            <div style="display: flex; gap: 10px;">
                                                <span style="background: #3498db; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">React</span>
                                                <span style="background: #27ae60; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">Node.js</span>
                                                <span style="background: #e74c3c; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">MongoDB</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                                        <img src="https://via.placeholder.com/400x250?text=Proyecto+2" alt="Proyecto 2" style="width: 100%; height: 250px; object-fit: cover;">
                                        <div style="padding: 25px;">
                                            <h3 style="color: #2c3e50; margin-bottom: 15px;">Task Management App</h3>
                                            <p style="color: #7f8c8d; margin-bottom: 20px;">Aplicación de gestión de tareas con Vue.js</p>
                                            <div style="display: flex; gap: 10px;">
                                                <span style="background: #2ecc71; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">Vue.js</span>
                                                <span style="background: #f39c12; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">Firebase</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                                        <img src="https://via.placeholder.com/400x250?text=Proyecto+3" alt="Proyecto 3" style="width: 100%; height: 250px; object-fit: cover;">
                                        <div style="padding: 25px;">
                                            <h3 style="color: #2c3e50; margin-bottom: 15px;">Weather Dashboard</h3>
                                            <p style="color: #7f8c8d; margin-bottom: 20px;">Dashboard del clima con APIs externas</p>
                                            <div style="display: flex; gap: 10px;">
                                                <span style="background: #9b59b6; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">JavaScript</span>
                                                <span style="background: #34495e; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">APIs</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section style="padding: 60px 20px; background: white;">
                            <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                                <h2 style="color: #2c3e50; margin-bottom: 30px;">Habilidades</h2>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px;">
                                    <div>
                                        <h3 style="color: #3498db; margin-bottom: 15px;">Frontend</h3>
                                        <p style="color: #7f8c8d;">HTML, CSS, JavaScript, React, Vue.js</p>
                                    </div>
                                    <div>
                                        <h3 style="color: #27ae60; margin-bottom: 15px;">Backend</h3>
                                        <p style="color: #7f8c8d;">Node.js, Python, PHP, Express</p>
                                    </div>
                                    <div>
                                        <h3 style="color: #e74c3c; margin-bottom: 15px;">Base de Datos</h3>
                                        <p style="color: #7f8c8d;">MongoDB, MySQL, PostgreSQL</p>
                                    </div>
                                    <div>
                                        <h3 style="color: #f39c12; margin-bottom: 15px;">Herramientas</h3>
                                        <p style="color: #7f8c8d;">Git, Docker, AWS, Figma</p>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            `,
            contact: `
                <div class="canvas-element container" data-element-type="container" data-element-id="container_4">
                    <div class="element-controls">
                        <button class="control-btn" onclick="editElement(this)" title="Editar">✏️</button>
                        <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">📋</button>
                        <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">🗑️</button>
                    </div>
                    <div class="nested-elements">
                        <header style="background: #2c3e50; color: white; padding: 40px 20px; text-align: center;">
                            <h1>Contacto</h1>
                            <p style="margin-top: 10px; opacity: 0.9;">¿Tienes alguna pregunta? ¡Escríbenos!</p>
                        </header>
                        <section style="padding: 60px 20px; background: #f8f9fa;">
                            <div style="max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 60px;">
                                <div>
                                    <h2 style="color: #2c3e50; margin-bottom: 30px;">Envíanos un mensaje</h2>
                                    <form style="background: white; padding: 40px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: bold;">Nombre completo</label>
                                            <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 16px;">
                                        </div>
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: bold;">Email</label>
                                            <input type="email" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 16px;">
                                        </div>
                                        <div style="margin-bottom: 20px;">
                                            <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: bold;">Asunto</label>
                                            <input type="text" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 16px;">
                                        </div>
                                        <div style="margin-bottom: 30px;">
                                            <label style="display: block; margin-bottom: 8px; color: #2c3e50; font-weight: bold;">Mensaje</label>
                                            <textarea style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 16px; height: 120px; resize: vertical;" placeholder="Escribe tu mensaje aquí..."></textarea>
                                        </div>
                                        <button type="submit" style="background: #3498db; color: white; padding: 15px 30px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; width: 100%;">Enviar Mensaje</button>
                                    </form>
                                </div>
                                <div>
                                    <h2 style="color: #2c3e50; margin-bottom: 30px;">Información de contacto</h2>
                                    <div style="background: white; padding: 40px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 30px;">
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #3498db; margin-bottom: 10px;">📍 Dirección</h3>
                                            <p style="color: #7f8c8d;">Calle Principal 123<br>Ciudad, País 12345</p>
                                        </div>
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #3498db; margin-bottom: 10px;">📞 Teléfono</h3>
                                            <p style="color: #7f8c8d;">+1 (555) 123-4567</p>
                                        </div>
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #3498db; margin-bottom: 10px;">✉️ Email</h3>
                                            <p style="color: #7f8c8d;">contacto@miempresa.com</p>
                                        </div>
                                        <div>
                                            <h3 style="color: #3498db; margin-bottom: 10px;">🕒 Horario</h3>
                                            <p style="color: #7f8c8d;">Lun - Vie: 9:00 AM - 6:00 PM<br>Sáb: 10:00 AM - 2:00 PM</p>
                                        </div>
                                    </div>
                                    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                        <h3 style="color: #2c3e50; margin-bottom: 20px;">Síguenos</h3>
                                        <div style="display: flex; gap: 15px;">
                                            <a href="#" style="background: #3b5998; color: white; padding: 10px; border-radius: 5px; text-decoration: none; display: inline-block;">Facebook</a>
                                            <a href="#" style="background: #1da1f2; color: white; padding: 10px; border-radius: 5px; text-decoration: none; display: inline-block;">Twitter</a>
                                            <a href="#" style="background: #0077b5; color: white; padding: 10px; border-radius: 5px; text-decoration: none; display: inline-block;">LinkedIn</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            `,
            ecommerce: `
                <div class="canvas-element container" data-element-type="container" data-element-id="container_5">
                    <div class="element-controls">
                        <button class="control-btn" onclick="editElement(this)" title="Editar">✏️</button>
                        <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">📋</button>
                        <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">🗑️</button>
                    </div>
                    <div class="nested-elements">
                        <header style="background: #2c3e50; color: white; padding: 15px 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto;">
                                <h1 style="font-size: 1.5rem;">🛍️ Mi Tienda</h1>
                                <nav style="display: flex; gap: 20px; align-items: center;">
                                    <a href="#" style="color: white; text-decoration: none;">Inicio</a>
                                    <a href="#" style="color: white; text-decoration: none;">Productos</a>
                                    <a href="#" style="color: white; text-decoration: none;">Contacto</a>
                                    <button style="background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">🛒 Carrito (0)</button>
                                </nav>
                            </div>
                        </header>
                        <section style="padding: 40px 20px; max-width: 1200px; margin: 0 auto;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: start;">
                                <div>
                                    <img src="https://via.placeholder.com/500x400?text=Producto+Principal" alt="Producto" style="width: 100%; border-radius: 10px; margin-bottom: 20px;">
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                                        <img src="https://via.placeholder.com/100x80?text=1" alt="Vista 1" style="width: 100%; border-radius: 5px; cursor: pointer; border: 2px solid #ddd;">
                                        <img src="https://via.placeholder.com/100x80?text=2" alt="Vista 2" style="width: 100%; border-radius: 5px; cursor: pointer; border: 2px solid #ddd;">
                                        <img src="https://via.placeholder.com/100x80?text=3" alt="Vista 3" style="width: 100%; border-radius: 5px; cursor: pointer; border: 2px solid #ddd;">
                                        <img src="https://via.placeholder.com/100x80?text=4" alt="Vista 4" style="width: 100%; border-radius: 5px; cursor: pointer; border: 2px solid #ddd;">
                                    </div>
                                </div>
                                <div>
                                    <h1 style="color: #2c3e50; margin-bottom: 15px; font-size: 2rem;">Smartphone Premium</h1>
                                    <div style="display: flex; align-items: center; margin-bottom: 20px;">
                                        <span style="color: #f39c12; margin-right: 10px;">⭐⭐⭐⭐⭐</span>
                                        <span style="color: #7f8c8d;">(127 reseñas)</span>
                                    </div>
                                    <div style="margin-bottom: 30px;">
                                        <span style="font-size: 2rem; color: #e74c3c; font-weight: bold;">$899.99</span>
                                        <span style="font-size: 1.2rem; color: #7f8c8d; text-decoration: line-through; margin-left: 10px;">$1,199.99</span>
                                        <span style="background: #27ae60; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; margin-left: 10px;">25% OFF</span>
                                    </div>
                                    <div style="margin-bottom: 30px;">
                                        <h3 style="color: #2c3e50; margin-bottom: 15px;">Descripción</h3>
                                        <p style="color: #7f8c8d; line-height: 1.6;">Smartphone de última generación con cámara de 108MP, pantalla AMOLED de 6.7", procesador octa-core y batería de larga duración. Incluye cargador inalámbrico y funda protectora.</p>
                                    </div>
                                    <div style="margin-bottom: 30px;">
                                        <h4 style="color: #2c3e50; margin-bottom: 15px;">Características principales:</h4>
                                        <ul style="color: #7f8c8d; line-height: 1.8;">
                                            <li>Pantalla AMOLED 6.7" 120Hz</li>
                                            <li>Cámara principal 108MP + ultra gran angular</li>
                                            <li>Procesador Snapdragon 8 Gen 2</li>
                                            <li>8GB RAM + 256GB almacenamiento</li>
                                            <li>Batería 5000mAh con carga rápida</li>
                                            <li>Resistente al agua IP68</li>
                                        </ul>
                                    </div>
                                    <div style="margin-bottom: 30px;">
                                        <label style="display: block; margin-bottom: 10px; color: #2c3e50; font-weight: bold;">Color:</label>
                                        <div style="display: flex; gap: 10px;">
                                            <button style="width: 40px; height: 40px; border-radius: 50%; background: #2c3e50; border: 3px solid #3498db; cursor: pointer;"></button>
                                            <button style="width: 40px; height: 40px; border-radius: 50%; background: #e74c3c; border: 2px solid #ddd; cursor: pointer;"></button>
                                            <button style="width: 40px; height: 40px; border-radius: 50%; background: #f39c12; border: 2px solid #ddd; cursor: pointer;"></button>
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 30px;">
                                        <label style="display: block; margin-bottom: 10px; color: #2c3e50; font-weight: bold;">Cantidad:</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button style="background: #95a5a6; color: white; border: none; width: 35px; height: 35px; border-radius: 5px; cursor: pointer; font-size: 18px;">-</button>
                                            <input type="number" value="1" min="1" style="width: 60px; padding: 8px; text-align: center; border: 2px solid #ddd; border-radius: 5px;">
                                            <button style="background: #95a5a6; color: white; border: none; width: 35px; height: 35px; border-radius: 5px; cursor: pointer; font-size: 18px;">+</button>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 15px; margin-bottom: 30px;">
                                        <button style="background: #3498db; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; flex: 1;">🛒 Agregar al Carrito</button>
                                        <button style="background: #27ae60; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; flex: 1;">💳 Comprar Ahora</button>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                                        <h4 style="color: #2c3e50; margin-bottom: 15px;">🚚 Información de envío</h4>
                                        <ul style="color: #7f8c8d; line-height: 1.6; font-size: 14px;">
                                            <li>✅ Envío gratis en pedidos superiores a $500</li>
                                            <li>📦 Entrega en 2-3 días hábiles</li>
                                            <li>🔄 Devoluciones gratuitas hasta 30 días</li>
                                            <li>🔒 Compra 100% segura</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            `,
            dashboard: `
                <div class="canvas-element container" data-element-type="container" data-element-id="container_6">
                    <div class="element-controls">
                        <button class="control-btn" onclick="editElement(this)" title="Editar">✏️</button>
                        <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">📋</button>
                        <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">🗑️</button>
                    </div>
                    <div class="nested-elements">
                        <div style="display: flex; min-height: 100vh;">
                            <nav style="width: 250px; background: #2c3e50; color: white; padding: 20px;">
                                <h2 style="margin-bottom: 30px; text-align: center;">📊 Dashboard</h2>
                                <ul style="list-style: none; padding: 0;">
                                    <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none; display: block; padding: 10px; border-radius: 5px; background: #3498db;">🏠 Inicio</a></li>
                                    <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none; display: block; padding: 10px; border-radius: 5px;">📈 Estadísticas</a></li>
                                    <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none; display: block; padding: 10px; border-radius: 5px;">👥 Usuarios</a></li>
                                    <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none; display: block; padding: 10px; border-radius: 5px;">🛍️ Productos</a></li>
                                    <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none; display: block; padding: 10px; border-radius: 5px;">📧 Mensajes</a></li>
                                    <li style="margin-bottom: 10px;"><a href="#" style="color: white; text-decoration: none; display: block; padding: 10px; border-radius: 5px;">⚙️ Configuración</a></li>
                                </ul>
                            </nav>
                            <main style="flex: 1; background: #f8f9fa; padding: 30px;">
                                <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                                    <h1 style="color: #2c3e50;">Panel de Control</h1>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <button style="background: #3498db; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">🔔 Notificaciones</button>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <img src="https://via.placeholder.com/40x40?text=U" alt="Usuario" style="width: 40px; height: 40px; border-radius: 50%;">
                                            <span style="color: #2c3e50;">Admin</span>
                                        </div>
                                    </div>
                                </header>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <p style="color: #7f8c8d; margin-bottom: 5px;">Usuarios Totales</p>
                                                <h3 style="color: #2c3e50; font-size: 2rem;">12,847</h3>
                                            </div>
                                            <div style="background: #3498db; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">👥</div>
                                        </div>
                                        <p style="color: #27ae60; font-size: 14px; margin-top: 10px;">↗️ +12% desde el mes pasado</p>
                                    </div>
                                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <p style="color: #7f8c8d; margin-bottom: 5px;">Ventas</p>
                                                <h3 style="color: #2c3e50; font-size: 2rem;">$45,239</h3>
                                            </div>
                                            <div style="background: #27ae60; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">💰</div>
                                        </div>
                                        <p style="color: #27ae60; font-size: 14px; margin-top: 10px;">↗️ +8% desde el mes pasado</p>
                                    </div>
                                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <p style="color: #7f8c8d; margin-bottom: 5px;">Pedidos</p>
                                                <h3 style="color: #2c3e50; font-size: 2rem;">1,847</h3>
                                            </div>
                                            <div style="background: #e74c3c; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">📦</div>
                                        </div>
                                        <p style="color: #e74c3c; font-size: 14px; margin-top: 10px;">↘️ -3% desde el mes pasado</p>
                                    </div>
                                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <p style="color: #7f8c8d; margin-bottom: 5px;">Productos</p>
                                                <h3 style="color: #2c3e50; font-size: 2rem;">247</h3>
                                            </div>
                                            <div style="background: #f39c12; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🛍️</div>
                                        </div>
                                        <p style="color: #27ae60; font-size: 14px; margin-top: 10px;">↗️ +5% desde el mes pasado</p>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px;">
                                    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                        <h3 style="color: #2c3e50; margin-bottom: 20px;">📈 Gráfico de Ventas</h3>
                                        <div style="height: 250px; background: linear-gradient(45deg, #f8f9fa 25%, transparent 25%), linear-gradient(-45deg, #f8f9fa 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f8f9fa 75%), linear-gradient(-45deg, transparent 75%, #f8f9fa 75%); background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px; border: 2px dashed #ddd; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #7f8c8d;">
                                            Aquí iría un gráfico de Chart.js o similar
                                        </div>
                                    </div>
                                    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                        <h3 style="color: #2c3e50; margin-bottom: 20px;">🔥 Productos Populares</h3>
                                        <div style="space-y: 15px;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                                                <div>
                                                    <p style="font-weight: bold; color: #2c3e50;">Smartphone Pro</p>
                                                    <p style="color: #7f8c8d; font-size: 14px;">847 ventas</p>
                                                </div>
                                                <span style="color: #27ae60;">$899</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                                                <div>
                                                    <p style="font-weight: bold; color: #2c3e50;">Laptop Gaming</p>
                                                    <p style="color: #7f8c8d; font-size: 14px;">623 ventas</p>
                                                </div>
                                                <span style="color: #27ae60;">$1,299</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                                                <div>
                                                    <p style="font-weight: bold; color: #2c3e50;">Auriculares BT</p>
                                                    <p style="color: #7f8c8d; font-size: 14px;">521 ventas</p>
                                                </div>
                                                <span style="color: #27ae60;">$199</span>
                                            </div>
                                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                                                <div>
                                                    <p style="font-weight: bold; color: #2c3e50;">Tablet Pro</p>
                                                    <p style="color: #7f8c8d; font-size: 14px;">445 ventas</p>
                                                </div>
                                                <span style="color: #27ae60;">$549</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                    <h3 style="color: #2c3e50; margin-bottom: 20px;">📋 Pedidos Recientes</h3>
                                    <div style="overflow-x: auto;">
                                        <table style="width: 100%; border-collapse: collapse;">
                                            <thead>
                                                <tr style="background: #f8f9fa;">
                                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; color: #2c3e50;">ID Pedido</th>
                                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; color: #2c3e50;">Cliente</th>
                                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; color: #2c3e50;">Producto</th>
                                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; color: #2c3e50;">Estado</th>
                                                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6; color: #2c3e50;">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">#12847</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Juan Pérez</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Smartphone Pro</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;"><span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">Entregado</span></td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">$899.99</td>
                                                </tr>
                                                <tr>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">#12846</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">María García</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Laptop Gaming</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;"><span style="background: #f39c12; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">En Proceso</span></td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">$1,299.99</td>
                                                </tr>
                                                <tr>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">#12845</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Carlos López</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Auriculares BT</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;"><span style="background: #3498db; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">Enviado</span></td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">$199.99</td>
                                                </tr>
                                                <tr>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">#12844</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Ana Martínez</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">Tablet Pro</td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;"><span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">Cancelado</span></td>
                                                    <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">$549.99</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </main>
                        </div>
                    </div>
                </div>
            `
        };

        // Elementos HTML predefinidos con sus propiedades
        const elementTemplates = {
            container: {
                tag: 'div',
                content: '<div class="nested-drop-zone">Arrastra elementos aquí</div>',
                style: 'padding: 20px; border: 2px dashed #3498db; border-radius: 8px; min-height: 100px; background: rgba(52, 152, 219, 0.05);',
                properties: ['id', 'class', 'style'],
                isContainer: true
            },
            grid: {
                tag: 'div',
                content: '<div class="nested-drop-zone">Elemento 1</div><div class="nested-drop-zone">Elemento 2</div><div class="nested-drop-zone">Elemento 3</div>',
                style: 'display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; padding: 20px; border: 2px dashed #9b59b6; border-radius: 8px; background: rgba(155, 89, 182, 0.05);',
                properties: ['id', 'class', 'style', 'grid-template-columns', 'gap'],
                isContainer: true
            },
            flexbox: {
                tag: 'div',
                content: '<div class="nested-drop-zone">Flex Item 1</div><div class="nested-drop-zone">Flex Item 2</div>',
                style: 'display: flex; gap: 20px; padding: 20px; border: 2px dashed #e67e22; border-radius: 8px; background: rgba(230, 126, 34, 0.05);',
                properties: ['id', 'class', 'style', 'flex-direction', 'justify-content', 'align-items', 'gap'],
                isContainer: true
            },
            section: {
                tag: 'section',
                content: '<div class="nested-drop-zone">Contenido de la sección</div>',
                style: 'padding: 30px; background: #f9f9f9; border-radius: 8px; border: 2px dashed #27ae60; background: rgba(39, 174, 96, 0.05);',
                properties: ['id', 'class', 'style'],
                isContainer: true
            },
            header: {
                tag: 'header',
                content: '<div class="nested-drop-zone">Contenido del header</div>',
                style: 'padding: 20px; background: #34495e; color: white; border-radius: 8px;',
                properties: ['id', 'class', 'style'],
                isContainer: true
            },
            footer: {
                tag: 'footer',
                content: '<div class="nested-drop-zone">Contenido del footer</div>',
                style: 'padding: 20px; background: #2c3e50; color: white; text-align: center; border-radius: 8px;',
                properties: ['id', 'class', 'style'],
                isContainer: true
            },
            nav: {
                tag: 'nav',
                content: '<a href="#" style="margin-right: 15px;">Inicio</a><a href="#" style="margin-right: 15px;">Acerca de</a><a href="#">Contacto</a>',
                style: 'padding: 15px; background: #3498db; border-radius: 8px;',
                properties: ['id', 'class', 'style']
            },
            aside: {
                tag: 'aside',
                content: '<div class="nested-drop-zone">Contenido lateral</div>',
                style: 'padding: 15px; background: #ecf0f1; border-left: 3px solid #3498db; border-radius: 8px;',
                properties: ['id', 'class', 'style'],
                isContainer: true
            },
            h1: {
                tag: 'h1',
                content: 'Título Principal',
                style: 'color: #2c3e50; margin-bottom: 20px;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            h2: {
                tag: 'h2',
                content: 'Subtítulo',
                style: 'color: #34495e; margin-bottom: 15px;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            h3: {
                tag: 'h3',
                content: 'Encabezado H3',
                style: 'color: #5d6d7e; margin-bottom: 10px;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            p: {
                tag: 'p',
                content: 'Este es un párrafo de texto. Puedes editar este contenido desde las propiedades.',
                style: 'line-height: 1.6; color: #333; margin-bottom: 15px;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            span: {
                tag: 'span',
                content: 'Texto en línea',
                style: 'background: #f1c40f; padding: 2px 6px; border-radius: 3px;',
                properties: ['id', 'class', 'style', 'textContent']
            },
            a: {
                tag: 'a',
                content: 'Enlace de ejemplo',
                style: 'color: #3498db; text-decoration: none;',
                properties: ['id', 'class', 'style', 'href', 'target', 'textContent']
            },
            form: {
                tag: 'form',
                content: '<div class="nested-drop-zone">Arrastra campos de formulario aquí</div>',
                style: 'padding: 20px; border: 1px solid #ddd; border-radius: 8px;',
                properties: ['id', 'class', 'action', 'method', 'style'],
                isContainer: true
            },
            input: {
                tag: 'input',
                content: '',
                style: 'padding: 10px; border: 2px solid #ddd; border-radius: 5px; width: 100%; margin-bottom: 15px;',
                properties: ['id', 'name', 'type', 'placeholder', 'value', 'class', 'style', 'required']
            },
            textarea: {
                tag: 'textarea',
                content: 'Área de texto...',
                style: 'padding: 10px; border: 2px solid #ddd; border-radius: 5px; width: 100%; height: 100px; margin-bottom: 15px; resize: vertical;',
                properties: ['id', 'name', 'placeholder', 'class', 'style', 'rows', 'cols']
            },
            button: {
                tag: 'button',
                content: 'Botón',
                style: 'padding: 12px 24px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;',
                properties: ['id', 'class', 'type', 'onclick', 'style', 'textContent']
            },
            select: {
                tag: 'select',
                content: '<option value="1">Opción 1</option><option value="2">Opción 2</option><option value="3">Opción 3</option>',
                style: 'padding: 10px; border: 2px solid #ddd; border-radius: 5px; width: 100%; margin-bottom: 15px;',
                properties: ['id', 'name', 'class', 'style', 'multiple']
            },
            label: {
                tag: 'label',
                content: 'Etiqueta:',
                style: 'font-weight: bold; margin-bottom: 5px; display: block; color: #2c3e50;',
                properties: ['for', 'class', 'style', 'textContent']
            },
            img: {
                tag: 'img',
                content: '',
                style: 'max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);',
                properties: ['src', 'alt', 'width', 'height', 'class', 'style']
            },
            video: {
                tag: 'video',
                content: '',
                style: 'width: 100%; max-width: 500px; border-radius: 8px;',
                properties: ['src', 'controls', 'width', 'height', 'autoplay', 'loop', 'class', 'style']
            },
            audio: {
                tag: 'audio',
                content: '',
                style: 'width: 100%;',
                properties: ['src', 'controls', 'autoplay', 'loop', 'class', 'style']
            },
            canvas: {
                tag: 'canvas',
                content: '',
                style: 'border: 2px solid #ddd; background: #f9f9f9; border-radius: 8px;',
                properties: ['width', 'height', 'class', 'style', 'id']
            }
        };

        // Event listeners para drag and drop
        document.querySelectorAll('.element-item[draggable="true"]').forEach(item => {
            item.addEventListener('dragstart', handleDragStart);
        });

        canvas.addEventListener('dragover', handleDragOver);
        canvas.addEventListener('drop', handleDrop);
        canvas.addEventListener('dragleave', handleDragLeave);

        // Inicializar eventos de contenedores anidados
        function initNestedDropZones() {
            document.querySelectorAll('.nested-drop-zone').forEach(zone => {
                zone.addEventListener('dragover', handleNestedDragOver);
                zone.addEventListener('drop', handleNestedDrop);
                zone.addEventListener('dragleave', handleNestedDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = e.target.dataset.type;
            e.dataTransfer.effectAllowed = 'copy';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            if (e.target === dropZone || e.target === canvas) {
                dropZone.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (!canvas.contains(e.relatedTarget)) {
                dropZone.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            
            if (draggedElement && elementTemplates[draggedElement]) {
                createAndAddElement(draggedElement, canvas);
                saveToHistory();
            }
        }

        function handleNestedDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            e.dataTransfer.dropEffect = 'copy';
            e.target.classList.add('drag-over');
        }

        function handleNestedDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleNestedDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.target.classList.remove('drag-over');
            
            if (draggedElement && elementTemplates[draggedElement]) {
                createAndAddElement(draggedElement, e.target);
                saveToHistory();
            }
        }

        function createAndAddElement(elementType, container) {
            const template = elementTemplates[elementType];
            const element = document.createElement(template.tag);
            
            elementCounter++;
            const elementId = `${elementType}_${elementCounter}`;
            
            // Configurar el elemento según su tipo
            setupElement(element, template, elementId);

            // Crear wrapper con controles
            const wrapper = document.createElement('div');
            wrapper.className = template.isContainer ? 'canvas-element container' : 'canvas-element';
            wrapper.dataset.elementType = elementType;
            wrapper.dataset.elementId = elementId;
            
            // Controles del elemento
            const controls = document.createElement('div');
            controls.className = 'element-controls';
            controls.innerHTML = `
                <button class="control-btn" onclick="editElement(this)" title="Editar">✏️</button>
                <button class="control-btn" onclick="duplicateElement(this)" title="Duplicar">📋</button>
                <button class="control-btn" onclick="deleteElement(this)" title="Eliminar">🗑️</button>
            `;

            wrapper.appendChild(element);
            wrapper.appendChild(controls);

            // Agregar al contenedor
            if (container === canvas && dropZone.style.display !== 'none') {
                dropZone.style.display = 'none';
            }
            
            if (container.classList && container.classList.contains('nested-drop-zone')) {
                container.innerHTML = '';
                container.appendChild(wrapper);
                container.classList.remove('nested-drop-zone');
                container.classList.add('nested-elements');
            } else {
                container.appendChild(wrapper);
            }

            // Event listeners
            wrapper.addEventListener('click', selectElement);

            // Inicializar zonas de drop anidadas si es necesario
            if (template.isContainer) {
                initNestedDropZones();
            }

            showToast(`${elementType.charAt(0).toUpperCase() + elementType.slice(1)} agregado correctamente`);
        }

        function setupElement(element, template, elementId) {
            // Agregar ID único
            element.id = elementId;
            
            // Agregar contenido
            if (template.content) {
                if (['img', 'input', 'video', 'audio', 'canvas'].includes(template.tag)) {
                    setupSpecialElements(element, template);
                } else {
                    element.innerHTML = template.content;
                }
            }

            // Agregar estilos
            if (template.style) {
                element.style.cssText = template.style;
            }
        }

        function setupSpecialElements(element, template) {
            switch (template.tag) {
                case 'img':
                    element.src = 'https://via.placeholder.com/300x200?text=Imagen+de+Ejemplo';
                    element.alt = 'Imagen de ejemplo';
                    break;
                case 'input':
                    element.type = 'text';
                    element.placeholder = 'Escribe aquí...';
                    break;
                case 'video':
                    element.controls = true;
                    element.innerHTML = '<source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">Tu navegador no soporta video HTML5.';
                    break;
                case 'audio':
                    element.controls = true;
                    element.innerHTML = '<source src="https://www.w3schools.com/html/horse.ogg" type="audio/ogg">Tu navegador no soporta audio HTML5.';
                    break;
                case 'canvas':
                    element.width = 400;
                    element.height = 200;
                    break;
            }
        }

        function selectElement(e) {
            // Remover selección anterior
            document.querySelectorAll('.canvas-element.selected').forEach(el => {
                el.classList.remove('selected');
            });

            // Seleccionar elemento actual
            const wrapper = e.currentTarget;
            wrapper.classList.add('selected');
            selectedElement = wrapper;

            // Mostrar propiedades
            showElementProperties(wrapper);
            updateElementTree();
            e.stopPropagation();
        }

        function showElementProperties(wrapper) {
            const elementType = wrapper.dataset.elementType;
            const template = elementTemplates[elementType];
            const element = wrapper.querySelector(template.tag);

            const propertiesContent = document.getElementById('propertiesContent');
            const breadcrumb = document.getElementById('elementBreadcrumb');
            const tree = document.getElementById('elementTree');
            
            // Mostrar breadcrumb
            breadcrumb.style.display = 'block';
            breadcrumb.textContent = `${template.tag.toUpperCase()} #${wrapper.dataset.elementId}`;
            
            // Mostrar árbol de elementos
            tree.style.display = 'block';
            updateElementTree();

            propertiesContent.innerHTML = `
                <div class="element-breadcrumb" id="elementBreadcrumb">${template.tag.toUpperCase()} #${wrapper.dataset.elementId}</div>
                <div class="tree-view" id="elementTree"></div>
                <h4>Propiedades de ${template.tag.toUpperCase()}</h4>
                <div id="propertyFields"></div>
            `;

            const propertyFields = document.getElementById('propertyFields');

            template.properties.forEach(prop => {
                const group = document.createElement('div');
                group.className = 'property-group';

                const label = document.createElement('label');
                label.className = 'property-label';
                label.textContent = prop.charAt(0).toUpperCase() + prop.slice(1).replace(/([A-Z])/g, ' $1');

                let input = createPropertyInput(prop, element, template);
                input.className = 'property-input';
                input.addEventListener('input', () => updateElementProperty(element, prop, input.value));

                group.appendChild(label);
                group.appendChild(input);
                propertyFields.appendChild(group);
            });

            // Agregar propiedades específicas de contenedores
            if (template.isContainer) {
                addContainerProperties(propertyFields, element);
            }
        }

        function createPropertyInput(prop, element, template) {
            let input;
            
            if (prop === 'textContent') {
                input = document.createElement('textarea');
                input.value = element.textContent || '';
            } else if (prop === 'style') {
                input = document.createElement('textarea');
                input.value = element.style.cssText || '';
                input.rows = 4;
            } else if (prop === 'type' && template.tag === 'input') {
                input = document.createElement('select');
                const types = ['text', 'email', 'password', 'number', 'date', 'checkbox', 'radio', 'file', 'hidden', 'submit', 'button'];
                types.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    if (element.type === type) option.selected = true;
                    input.appendChild(option);
                });
            } else if (prop === 'target' && template.tag === 'a') {
                input = document.createElement('select');
                const targets = ['', '_blank', '_self', '_parent', '_top'];
                targets.forEach(target => {
                    const option = document.createElement('option');
                    option.value = target;
                    option.textContent = target || 'Sin target';
                    if (element.target === target) option.selected = true;
                    input.appendChild(option);
                });
            } else if (['grid-template-columns', 'flex-direction', 'justify-content', 'align-items'].includes(prop)) {
                input = createLayoutInput(prop, element);
            } else {
                input = document.createElement('input');
                input.type = 'text';
                input.value = element.getAttribute(prop) || '';
            }
            
            return input;
        }

        function createLayoutInput(prop, element) {
            const input = document.createElement('select');
            let options = [];
            
            switch (prop) {
                case 'grid-template-columns':
                    options = [
                        { value: 'repeat(1, 1fr)', text: '1 columna' },
                        { value: 'repeat(2, 1fr)', text: '2 columnas' },
                        { value: 'repeat(3, 1fr)', text: '3 columnas' },
                        { value: 'repeat(4, 1fr)', text: '4 columnas' },
                        { value: 'repeat(auto-fit, minmax(250px, 1fr))', text: 'Responsive' }
                    ];
                    break;
                case 'flex-direction':
                    options = [
                        { value: 'row', text: 'Horizontal' },
                        { value: 'column', text: 'Vertical' },
                        { value: 'row-reverse', text: 'Horizontal inverso' },
                        { value: 'column-reverse', text: 'Vertical inverso' }
                    ];
                    break;
                case 'justify-content':
                    options = [
                        { value: 'flex-start', text: 'Inicio' },
                        { value: 'center', text: 'Centro' },
                        { value: 'flex-end', text: 'Final' },
                        { value: 'space-between', text: 'Espacio entre' },
                        { value: 'space-around', text: 'Espacio alrededor' },
                        { value: 'space-evenly', text: 'Espacio uniforme' }
                    ];
                    break;
                case 'align-items':
                    options = [
                        { value: 'flex-start', text: 'Inicio' },
                        { value: 'center', text: 'Centro' },
                        { value: 'flex-end', text: 'Final' },
                        { value: 'stretch', text: 'Estirar' },
                        { value: 'baseline', text: 'Línea base' }
                    ];
                    break;
            }
            
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.value;
                opt.textContent = option.text;
                input.appendChild(opt);
            });
            
            return input;
        }

        function addContainerProperties(container, element) {
            // Agregar botón para limpiar contenedor
            const clearButton = document.createElement('button');
            clearButton.textContent = '🗑️ Limpiar Contenedor';
            clearButton.className = 'btn-secondary';
            clearButton.style.width = '100%';
            clearButton.style.marginTop = '15px';
            clearButton.onclick = () => clearContainer(element);
            container.appendChild(clearButton);
        }

        function clearContainer(element) {
            if (confirm('¿Estás seguro de que quieres limpiar este contenedor?')) {
                element.innerHTML = '<div class="nested-drop-zone">Arrastra elementos aquí</div>';
                initNestedDropZones();
                saveToHistory();
                showToast('Contenedor limpiado');
            }
        }

        function updateElementProperty(element, property, value) {
            if (property === 'textContent') {
                element.textContent = value;
            } else if (property === 'style') {
                element.style.cssText = value;
            } else if (['grid-template-columns', 'flex-direction', 'justify-content', 'align-items', 'gap'].includes(property)) {
                element.style[property] = value;
            } else {
                if (value) {
                    element.setAttribute(property, value);
                } else {
                    element.removeAttribute(property);
                }
            }
            saveToHistory();
        }

        function updateElementTree() {
            const tree = document.getElementById('elementTree');
            if (!tree) return;
            
            tree.innerHTML = '<h4 style="margin-bottom: 10px;">🌳 Estructura de Elementos</h4>';
            
            const elements = canvas.querySelectorAll('.canvas-element');
            elements.forEach((element, index) => {
                const elementType = element.dataset.elementType;
                const elementId = element.dataset.elementId;
                const isSelected = element.classList.contains('selected');
                
                const treeItem = document.createElement('div');
                treeItem.className = `tree-item ${isSelected ? 'selected' : ''}`;
                treeItem.textContent = `${elementType.toUpperCase()} #${elementId}`;
                treeItem.onclick = () => {
                    selectElement({ currentTarget: element, stopPropagation: () => {} });
                };
                
                tree.appendChild(treeItem);
                
                // Agregar elementos anidados
                const nestedElements = element.querySelectorAll('.canvas-element');
                nestedElements.forEach(nested => {
                    const nestedType = nested.dataset.elementType;
                    const nestedId = nested.dataset.elementId;
                    const nestedItem = document.createElement('div');
                    nestedItem.className = 'tree-item tree-indent';
                    nestedItem.textContent = `↳ ${nestedType.toUpperCase()} #${nestedId}`;
                    nestedItem.onclick = (e) => {
                        e.stopPropagation();
                        selectElement({ currentTarget: nested, stopPropagation: () => {} });
                    };
                    tree.appendChild(nestedItem);
                });
            });
        }

        function editElement(btn) {
            const wrapper = btn.closest('.canvas-element');
            selectElement({ currentTarget: wrapper, stopPropagation: () => {} });
            toggleProperties(true);
        }

        function duplicateElement(btn) {
            const wrapper = btn.closest('.canvas-element');
            const elementType = wrapper.dataset.elementType;
            const parent = wrapper.parentElement;
            
            if (parent.classList.contains('nested-elements')) {
                createAndAddElement(elementType, parent);
            } else {
                createAndAddElement(elementType, canvas);
            }
            saveToHistory();
        }

        function deleteElement(btn) {
            const wrapper = btn.closest('.canvas-element');
            const parent = wrapper.parentElement;
            
            wrapper.remove();
            
            // Si el contenedor padre queda vacío, restaurar la zona de drop
            if (parent.classList.contains('nested-elements') && parent.children.length === 0) {
                parent.innerHTML = '<div class="nested-drop-zone">Arrastra elementos aquí</div>';
                parent.classList.remove('nested-elements');
                parent.classList.add('nested-drop-zone');
                initNestedDropZones();
            }
            
            // Mostrar drop zone principal si no hay elementos
            if (canvas.querySelectorAll('.canvas-element').length === 0) {
                dropZone.style.display = 'flex';
            }
            
            saveToHistory();
            showToast('Elemento eliminado');
            
            // Actualizar panel de propiedades
            if (selectedElement === wrapper) {
                selectedElement = null;
                document.getElementById('propertiesContent').innerHTML = '<p>Selecciona un elemento para editar sus propiedades</p>';
            }
        }

        function toggleProperties(forceOpen = false) {
            const panel = document.getElementById('propertiesPanel');
            if (forceOpen || !panel.classList.contains('active')) {
                panel.classList.add('active');
            } else {
                panel.classList.remove('active');
            }
        }

        function showTemplates() {
            document.getElementById('templatesModal').style.display = 'block';
        }

        function loadTemplate(templateName) {
            if (templates[templateName]) {
                if (confirm('¿Estás seguro? Esto reemplazará el contenido actual.')) {
                    canvas.innerHTML = templates[templateName];
                    dropZone = document.getElementById('dropZone');
                    if (dropZone) dropZone.style.display = 'none';
                    
                    // Reinicializar event listeners
                    canvas.querySelectorAll('.canvas-element').forEach(wrapper => {
                        wrapper.addEventListener('click', selectElement);
                    });
                    
                    initNestedDropZones();
                    saveToHistory();
                    showToast(`Plantilla ${templateName} cargada correctamente`);
                    closeModal('templatesModal');
                }
            }
        }

        function previewPage() {
            const previewModal = document.getElementById('previewModal');
            const previewFrame = document.getElementById('previewFrame');
            
            const htmlContent = generateHTMLContent();
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            previewFrame.src = url;
            previewModal.style.display = 'block';
        }

        function exportHTML() {
            const exportModal = document.getElementById('exportModal');
            const codePreview = document.getElementById('codePreview');
            
            codePreview.textContent = generateHTMLContent();
            exportModal.style.display = 'block';
        }

        function generateHTMLContent() {
            const elements = canvas.querySelectorAll('.canvas-element');
            let bodyContent = '';

            elements.forEach(wrapper => {
                const element = wrapper.firstElementChild.cloneNode(true);
                
                // Limpiar elementos anidados de controles y clases de desarrollo
                cleanElementForExport(element);
                
                bodyContent += element.outerHTML + '\n';
            });

            return `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Página Web - Creada con PageMaker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        /* Estilos responsivos */
        @media (max-width: 768px) {
            .container {
                padding: 10px !important;
            }
            
            h1 {
                font-size: 1.8rem !important;
            }
            
            h2 {
                font-size: 1.5rem !important;
            }
            
            .grid {
                grid-template-columns: 1fr !important;
            }
            
            .flex {
                flex-direction: column !important;
            }
        }
        
        /* Estilos para interactividad */
        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        a:hover {
            opacity: 0.8;
        }
        
        img:hover {
            transform: scale(1.02);
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body>
${bodyContent}

<script>
    // Agregar interactividad básica
    document.addEventListener('DOMContentLoaded', function() {
        // Smooth scrolling para enlaces
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // Formularios básicos
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                alert('¡Formulario enviado! (Funcionalidad de ejemplo)');
            });
        });
        
        // Botones interactivos
        document.querySelectorAll('button').forEach(button => {
            if (!button.type || button.type !== 'submit') {
                button.addEventListener('click', function() {
                    console.log('Botón clickeado:', this.textContent);
                });
            }
        });
    });
</script>
</body>
</html>`;
        }

        function cleanElementForExport(element) {
            // Remover zonas de drop y elementos de desarrollo
            element.querySelectorAll('.nested-drop-zone, .element-controls').forEach(el => {
                el.remove();
            });
            
            // Limpiar clases de desarrollo
            element.querySelectorAll('.nested-elements').forEach(el => {
                el.classList.remove('nested-elements');
            });
            
            // Remover atributos de desarrollo
            element.removeAttribute('data-element-type');
            element.removeAttribute('data-element-id');
        }

        function copyToClipboard() {
            const codePreview = document.getElementById('codePreview');
            navigator.clipboard.writeText(codePreview.textContent).then(() => {
                showToast('Código copiado al portapapeles');
            }).catch(() => {
                // Fallback para navegadores más antiguos
                const textArea = document.createElement('textarea');
                textArea.value = codePreview.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('Código copiado al portapapeles');
            });
        }

        function downloadHTML() {
            const htmlContent = generateHTMLContent();
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mi-pagina-web.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Archivo HTML descargado');
        }

        function clearCanvas() {
            if (confirm('¿Estás seguro de que quieres limpiar el canvas?')) {
                canvas.innerHTML = '<div class="drop-zone" id="dropZone">✨ Arrastra elementos aquí para comenzar a crear tu página web</div>';
                dropZone = document.getElementById('dropZone');
                canvas.addEventListener('dragover', handleDragOver);
                canvas.addEventListener('drop', handleDrop);
                canvas.addEventListener('dragleave', handleDragLeave);
                selectedElement = null;
                document.getElementById('propertiesContent').innerHTML = '<p>Selecciona un elemento para editar sus propiedades</p>';
                saveToHistory();
                showToast('Canvas limpiado');
            }
        }

        function saveToHistory() {
            historyStep++;
            if (historyStep < history.length) {
                history.length = historyStep;
            }
            history.push(canvas.innerHTML);
        }

        function undoAction() {
            if (historyStep > 0) {
                historyStep--;
                canvas.innerHTML = history[historyStep];
                dropZone = document.getElementById('dropZone');
                
                // Reattach event listeners
                canvas.querySelectorAll('.canvas-element').forEach(wrapper => {
                    wrapper.addEventListener('click', selectElement);
                });
                
                initNestedDropZones();
                showToast('Acción deshecha');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Event listeners globales
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.canvas-element') && !e.target.closest('.properties-panel')) {
                document.querySelectorAll('.canvas-element.selected').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedElement = null;
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
            
            // Atajos de teclado
            if (e.ctrlKey && e.key === 'z') {
                e.preventDefault();
                undoAction();
            }
            
            if (e.key === 'Delete' && selectedElement) {
                const deleteBtn = selectedElement.querySelector('.control-btn[title="Eliminar"]');
                if (deleteBtn) deleteBtn.click();
            }
        });

        // Cerrar modales clickeando fuera
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Inicialización
        saveToHistory();
        initNestedDropZones();

        console.log('🚀 PageMaker Pro cargado correctamente');
        console.log('💡 Tips:');
        console.log('   - Arrastra elementos desde el sidebar');
        console.log('   - Usa contenedores para crear layouts complejos');
        console.log('   - Carga plantillas predefinidas para empezar rápido');
        console.log('   - Usa Ctrl+Z para deshacer');
        console.log('   - Presiona Delete para eliminar el elemento seleccionado');
    </script>
</body>
</html>